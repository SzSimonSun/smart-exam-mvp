<!DOCTYPE html>
<html>
<head>
    <title>æ‹†é¢˜æ•°æ®æµ‹è¯•</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>æ‹†é¢˜æ•°æ®æµ‹è¯•</h1>
    <div id="result"></div>
    
    <script>
        // æµ‹è¯•æ‹†é¢˜æ•°æ®APIè°ƒç”¨
        async function testIngestData() {
            try {
                const token = 'token_for_13_e64c7d89';
                
                // è·å–ä¼šè¯åˆ—è¡¨
                console.log('ğŸ” è·å–æ‹†é¢˜ä¼šè¯åˆ—è¡¨...');
                const sessionsResponse = await fetch('http://localhost:8000/api/ingest/sessions', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const sessions = await sessionsResponse.json();
                console.log('âœ… ä¼šè¯åˆ—è¡¨:', sessions);
                
                if (sessions.length > 0) {
                    const sessionId = sessions[0].id;
                    console.log(`ğŸ” è·å–ä¼šè¯ ${sessionId} çš„æ‹†é¢˜é¡¹ç›®...`);
                    
                    // è·å–æ‹†é¢˜é¡¹ç›®
                    const itemsResponse = await fetch(`http://localhost:8000/api/ingest/sessions/${sessionId}/items`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    const items = await itemsResponse.json();
                    console.log('âœ… æ‹†é¢˜é¡¹ç›®:', items);
                    
                    // æ˜¾ç¤ºç»“æœ
                    const resultDiv = document.getElementById('result');
                    resultDiv.innerHTML = `
                        <h2>æ‹†é¢˜ä¼šè¯: ${sessions[0].name}</h2>
                        <p>çŠ¶æ€: ${sessions[0].status}</p>
                        <p>æ€»é¢˜ç›®: ${sessions[0].total_items}</p>
                        <h3>æ‹†é¢˜é¡¹ç›® (å…±${items.length}ä¸ª):</h3>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${items.map(item => `
                                <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0;">
                                    <strong>é¢˜ç›® ${item.seq}:</strong> ${item.question_text || 'è¯†åˆ«æ–‡æœ¬ä¸ºç©º'}<br>
                                    <em>ç±»å‹: ${item.candidate_type}, ç½®ä¿¡åº¦: ${(item.confidence * 100).toFixed(1)}%, çŠ¶æ€: ${item.review_status}</em>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    document.getElementById('result').innerHTML = '<p>âŒ æ²¡æœ‰æ‰¾åˆ°æ‹†é¢˜ä¼šè¯</p>';
                }
                
            } catch (error) {
                console.error('âŒ æµ‹è¯•å¤±è´¥:', error);
                document.getElementById('result').innerHTML = `<p>âŒ æµ‹è¯•å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œæµ‹è¯•
        testIngestData();
    </script>
</body>
</html>